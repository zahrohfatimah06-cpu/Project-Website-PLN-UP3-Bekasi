<?php
// data_gangguan_tm_lebih_5.php

$data = [
    // Januari sampai Juni (sudah ada sebelumnya) ...
    ['unit' => 'UP3 BEKASI', 'bulan' => 'JANUARI', 'target' => 98.00, 'realisasi' => 74.00, '%pencapaian' => '124,49%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'JANUARI', 'target' => 13.00, 'realisasi' => 10.00, '%pencapaian' => '123,08%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'JANUARI', 'target' => 5.00, 'realisasi' => 3.00, '%pencapaian' => '140,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'JANUARI', 'target' => 35.00, 'realisasi' => 27.00, '%pencapaian' => '122,86%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'JANUARI', 'target' => 13.00, 'realisasi' => 10.00, '%pencapaian' => '123,08%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'JANUARI', 'target' => 26.00, 'realisasi' => 20.00, '%pencapaian' => '123,08%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'JANUARI', 'target' => 6.00, 'realisasi' => 4.00, '%pencapaian' => '133,33%'],

    ['unit' => 'UP3 BEKASI', 'bulan' => 'FEBRUARI', 'target' => 198.00, 'realisasi' => 181.00, '%pencapaian' => '108,59%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'FEBRUARI', 'target' => 32.00, 'realisasi' => 29.00, '%pencapaian' => '109,38%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'FEBRUARI', 'target' => 17.00, 'realisasi' => 15.00, '%pencapaian' => '111,76%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'FEBRUARI', 'target' => 59.00, 'realisasi' => 55.00, '%pencapaian' => '106,78%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'FEBRUARI', 'target' => 32.00, 'realisasi' => 29.00, '%pencapaian' => '109,38%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'FEBRUARI', 'target' => 45.00, 'realisasi' => 42.00, '%pencapaian' => '106,67%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'FEBRUARI', 'target' => 13.00, 'realisasi' => 11.00, '%pencapaian' => '115,38%'],
    // Maret
    ['unit' => 'UP3 BEKASI', 'bulan' => 'MARET', 'target' => 297.00, 'realisasi' => 240.00, '%pencapaian' => '119,19%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'MARET', 'target' => 49.00, 'realisasi' => 40.00, '%pencapaian' => '118,37%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'MARET', 'target' => 25.00, 'realisasi' => 20.00, '%pencapaian' => '120,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'MARET', 'target' => 87.00, 'realisasi' => 71.00, '%pencapaian' => '118,39%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'MARET', 'target' => 52.00, 'realisasi' => 42.00, '%pencapaian' => '119,23%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'MARET', 'target' => 66.00, 'realisasi' => 53.00, '%pencapaian' => '119,70%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'MARET', 'target' => 18.00, 'realisasi' => 14.00, '%pencapaian' => '122,22%'],

        // April
    ['unit' => 'UP3 BEKASI', 'bulan' => 'APRIL', 'target' => 396.00, 'realisasi' => 279.00, '%pencapaian' => '129,55%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'APRIL', 'target' => 61.00, 'realisasi' => 43.00, '%pencapaian' => '129,51%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'APRIL', 'target' => 37.00, 'realisasi' => 27.00, '%pencapaian' => '127,03%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'APRIL', 'target' => 115.00, 'realisasi' => 80.00, '%pencapaian' => '130,43%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'APRIL', 'target' => 70.00, 'realisasi' => 49.00, '%pencapaian' => '130,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'APRIL', 'target' => 85.00, 'realisasi' => 62.00, '%pencapaian' => '127,06%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'APRIL', 'target' => 28.00, 'realisasi' => 18.00, '%pencapaian' => '135,71%'],

    // Mei
    ['unit' => 'UP3 BEKASI', 'bulan' => 'MEI', 'target' => 495.00, 'realisasi' => 319.00, '%pencapaian' => '135,56%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'MEI', 'target' => 80.00, 'realisasi' => 52.00, '%pencapaian' => '135,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'MEI', 'target' => 50.00, 'realisasi' => 31.00, '%pencapaian' => '138,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'MEI', 'target' => 138.00, 'realisasi' => 93.00, '%pencapaian' => '132,61%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'MEI', 'target' => 82.00, 'realisasi' => 56.00, '%pencapaian' => '131,71%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'MEI', 'target' => 110.00, 'realisasi' => 67.00, '%pencapaian' => '139,09%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'MEI', 'target' => 35.00, 'realisasi' => 20.00, '%pencapaian' => '142,86%'],
    
    ['unit' => 'UP3 BEKASI', 'bulan' => 'JUNI', 'target' => 594.00, 'realisasi' => 365.00, '%pencapaian' => '138,55%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'JUNI', 'target' => 110.00, 'realisasi' => 66.00, '%pencapaian' => '140,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'JUNI', 'target' => 55.00, 'realisasi' => 32.00, '%pencapaian' => '141,82%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'JUNI', 'target' => 162.00, 'realisasi' => 107.00, '%pencapaian' => '133,95%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'JUNI', 'target' => 100.00, 'realisasi' => 60.00, '%pencapaian' => '140,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'JUNI', 'target' => 126.00, 'realisasi' => 79.00, '%pencapaian' => '137,30%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'JUNI', 'target' => 41.00, 'realisasi' => 21.00, '%pencapaian' => '148,78%'],

    // Juli sampai Desember dengan realisasi 0 dan % pencapaian 200%
    ['unit' => 'UP3 BEKASI', 'bulan' => 'JULI', 'target' => 692.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'JULI', 'target' => 130.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'JULI', 'target' => 65.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'JULI', 'target' => 182.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'JULI', 'target' => 120.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'JULI', 'target' => 145.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'JULI', 'target' => 50.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],

    ['unit' => 'UP3 BEKASI', 'bulan' => 'AGUSTUS', 'target' => 791.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'AGUSTUS', 'target' => 150.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'AGUSTUS', 'target' => 75.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'AGUSTUS', 'target' => 202.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'AGUSTUS', 'target' => 140.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'AGUSTUS', 'target' => 164.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'AGUSTUS', 'target' => 60.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],

    ['unit' => 'UP3 BEKASI', 'bulan' => 'SEPTEMBER', 'target' => 890.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'SEPTEMBER', 'target' => 170.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'SEPTEMBER', 'target' => 85.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'SEPTEMBER', 'target' => 222.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'SEPTEMBER', 'target' => 160.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'SEPTEMBER', 'target' => 183.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'SEPTEMBER', 'target' => 70.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],

    ['unit' => 'UP3 BEKASI', 'bulan' => 'OKTOBER', 'target' => 989.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'OKTOBER', 'target' => 185.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'OKTOBER', 'target' => 89.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'OKTOBER', 'target' => 250.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'OKTOBER', 'target' => 180.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'OKTOBER', 'target' => 210.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'OKTOBER', 'target' => 75.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],

    ['unit' => 'UP3 BEKASI', 'bulan' => 'NOVEMBER', 'target' => 1088.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'NOVEMBER', 'target' => 195.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'NOVEMBER', 'target' => 93.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'NOVEMBER', 'target' => 280.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'NOVEMBER', 'target' => 190.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'NOVEMBER', 'target' => 250.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'NOVEMBER', 'target' => 80.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],

    ['unit' => 'UP3 BEKASI', 'bulan' => 'DESEMBER', 'target' => 1187.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BEKASI KOTA', 'bulan' => 'DESEMBER', 'target' => 203.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MEDAN SATRIA', 'bulan' => 'DESEMBER', 'target' => 97.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BABELAN', 'bulan' => 'DESEMBER', 'target' => 310.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP BANTARGEBANG', 'bulan' => 'DESEMBER', 'target' => 204.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP MUSTIKAJAYA', 'bulan' => 'DESEMBER', 'target' => 288.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
    ['unit' => 'ULP PRIMA BEKASI', 'bulan' => 'DESEMBER', 'target' => 85.00, 'realisasi' => 0.00, '%pencapaian' => '200,00%'],
];
?>
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Data Gangguan TM > 5 Menit - PLN</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    :root {
        --pln-blue: #0A4C95;
        --pln-yellow: #FFC107;
        --pln-light: #f8f9fa;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f4f6f9;
        padding: 20px;
        color: #333;
    }
    
    .header-pln {
        background: var(--pln-blue);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .card {
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        border: none;
        transition: transform 0.3s;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    }
    
    .card-header {
        background: var(--pln-blue);
        color: white;
        font-weight: 600;
        border-radius: 10px 10px 0 0 !important;
    }
    
    .filter-section {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }
    
    .chart-container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        margin-bottom: 20px;
        height: 100%;
    }
    
    .stat-card {
        text-align: center;
        padding: 15px;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--pln-blue);
    }
    
    .stat-label {
        font-size: 14px;
        color: #6c757d;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.05);
        border-radius: 10px;
        overflow: hidden;
    }
    
    thead {
        background-color: var(--pln-blue);
        color: white;
        font-weight: bold;
    }
    
    th, td {
        padding: 12px 15px;
        text-align: center;
    }
    
    tbody tr:nth-child(even) {
        background: #f9fafb;
    }
    
    tbody tr:hover {
        background-color: rgba(255, 203, 5, 0.2);
    }
    
    .btn-pln {
        background: var(--pln-blue);
        color: white;
        font-weight: 600;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        transition: all 0.3s;
    }
    
    .btn-pln:hover {
        background: #073b76;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .best-unit {
        color: #28a745;
        font-weight: bold;
    }
    
    .worst-unit {
        color: #dc3545;
        font-weight: bold;
    }
</style>
</head>
<body>
    <div style="margin-bottom: 20px; text-align: left;">
    <a href="lihat_pi.php" style="
        display: inline-block;
        background-color: #004aad;
        color: white;
        padding: 10px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        box-shadow: 0 4px 8px rgba(0, 74, 173, 0.3);
        transition: background-color 0.3s ease;
    " 
    onmouseover="this.style.backgroundColor='#003a80';"
    onmouseout="this.style.backgroundColor='#004aad';"
    >
        <i class="fas fa-arrow-left" style="margin-right: 8px;"></i> Kembali ke Lihat PI
    </a>
</div>
    
<div class="container-fluid">
    <!-- Header -->
    <div class="header-pln text-center">
        <h1>Data Gangguan TM &gt; 5 Menit</h1>
        <p class="mb-0">Tahun 2025 - PLN UP3 BEKASI</p>
    </div>
    
    
    <!-- Filter Section -->
    <div class="filter-section">
        <div class="row">
            <div class="col-md-5 mb-3">
                <label class="form-label">Pilih Unit</label>
                <select class="form-select" id="unitFilter">
                    <option value="all">Semua Unit</option>
                    <option value="UP3 BEKASI">UP3 BEKASI</option>
                    <option value="ULP BEKASI KOTA">ULP BEKASI KOTA</option>
                    <option value="ULP MEDAN SATRIA">ULP MEDAN SATRIA</option>
                    <option value="ULP BABELAN">ULP BABELAN</option>
                    <option value="ULP BANTARGEBANG">ULP BANTARGEBANG</option>
                    <option value="ULP MUSTIKAJAYA">ULP MUSTIKAJAYA</option>
                    <option value="ULP PRIMA BEKASI">ULP PRIMA BEKASI</option>
                </select>
            </div>
            <div class="col-md-5 mb-3">
                <label class="form-label">Pilih Bulan</label>
                <select class="form-select" id="monthFilter">
                    <option value="all">Semua Bulan</option>
                    <option value="JANUARI">januari</option>
                    <option value="FEBRUARI">februari</option>
                    <option value="MARET">maret</option>
                    <option value="APRIL">april</option>
                    <option value="MEI">mei</option>
                    <option value="JUNI">Juni</option>
                    <option value="JULI">Juli</option>
                    <option value="AGUSTUS">Agustus</option>
                    <option value="SEPTEMBER">September</option>
                    <option value="OKTOBER">Oktober</option>
                    <option value="NOVEMBER">November</option>
                    <option value="DESEMBER">Desember</option>
                </select>
                
            </div>
            <div class="col-md-2 d-flex align-items-end mb-3">
                <button class="btn btn-pln w-100" id="applyFilter">
                    <i class="fas fa-filter me-2"></i>Terapkan
                </button>

            </div>
        </div>
    </div>
    
    <!-- Stat Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card">
                <div class="stat-card">
                    <div class="stat-value" id="totalUnit">7</div>
                    <div class="stat-label">Jumlah Unit</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="stat-card">
                    <div class="stat-value" id="totalMonth">7</div>
                    <div class="stat-label">Jumlah Bulan</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="stat-card">
                    <div class="stat-value best-unit" id="bestUnit">ULP PRIMA BEKASI</div>
                    <div class="stat-label">Unit Terbaik</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="stat-card">
                    <div class="stat-value worst-unit" id="worstUnit">UP3 BEKASI</div>
                    <div class="stat-label">Unit Terburuk</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="chart-container">
                <h5 class="text-center mb-4">Realisasi per Bulan</h5>
                <canvas id="barChart"></canvas>
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-container">
                <h5 class="text-center mb-4">Tren Realisasi</h5>
                <canvas id="lineChart"></canvas>
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-container">
                <h5 class="text-center mb-4">Distribusi Pencapaian</h5>
                <canvas id="pieChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Data Table -->
    <div class="card">
        <div class="card-header">
            <i class="fas fa-table me-2"></i>Detail Data Gangguan TM > 5 Menit
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>UNIT</th>
                            <th>BULAN</th>
                            <th>TARGET 2025</th>
                            <th>REALISASI 2025</th>
                            <th>% PENCAPAIAN</th>
                        </tr>
                    </thead>
                    <tbody id="dataTable">
                        <?php foreach ($data as $row): ?>
                        <tr>
                            <td><?= htmlspecialchars($row['unit']) ?></td>
                            <td><?= htmlspecialchars($row['bulan']) ?></td>
                            <td><?= number_format($row['target'], 2, '.', ',') ?></td>
                            <td><?= number_format($row['realisasi'], 2, '.', ',') ?></td>
                            <td><?= htmlspecialchars($row['%pencapaian']) ?></td>
                        </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Data dari PHP
    const data = <?= json_encode($data) ?>;
    
    // Grafik inisialisasi
    const barCtx = document.getElementById('barChart').getContext('2d');
    const lineCtx = document.getElementById('lineChart').getContext('2d');
    const pieCtx = document.getElementById('pieChart').getContext('2d');
    
    let barChart, lineChart, pieChart;
    
    // Fungsi untuk mengubah persentase menjadi angka
    function parsePercentage(pct) {
        return parseFloat(pct.replace('%', '').replace(',', '.'));
    }
    
    // Fungsi untuk mendapatkan unit unik
    function getUniqueUnits() {
        return [...new Set(data.map(item => item.unit))];
    }
    
    // Fungsi untuk mendapatkan bulan unik
    function getUniqueMonths() {
        return [...new Set(data.map(item => item.bulan))];
    }
    
    // Fungsi untuk menghitung statistik
    function calculateStats() {
        const units = getUniqueUnits();
        const months = getUniqueMonths();
        
        // Hitung unit terbaik dan terburuk
        const unitPerformance = {};
        units.forEach(unit => {
            const unitData = data.filter(d => d.unit === unit);
            const avgPerformance = unitData.reduce((sum, d) => 
                sum + parsePercentage(d['%pencapaian']), 0) / unitData.length;
            unitPerformance[unit] = avgPerformance;
        });
        
        const sortedUnits = Object.entries(unitPerformance).sort((a, b) => b[1] - a[1]);
        const bestUnit = sortedUnits[0][0];
        const worstUnit = sortedUnits[sortedUnits.length - 1][0];
        
        // Update card
        document.getElementById('totalUnit').textContent = units.length;
        document.getElementById('totalMonth').textContent = months.length;
        document.getElementById('bestUnit').textContent = bestUnit;
        document.getElementById('worstUnit').textContent = worstUnit;
    }
    
    // Fungsi untuk update grafik
    function updateCharts(unitFilter = 'all', monthFilter = 'all') {
        // Filter data
        let filteredData = data;
        if (unitFilter !== 'all') {
            filteredData = filteredData.filter(d => d.unit === unitFilter);
        }
        if (monthFilter !== 'all') {
            filteredData = filteredData.filter(d => d.bulan === monthFilter);
        }
        
        // Data untuk grafik batang (per bulan)
        const months = ['JUNI', 'JULI', 'AGUSTUS', 'SEPTEMBER', 'OKTOBER', 'NOVEMBER', 'DESEMBER'];
        const monthlyData = {};
        months.forEach(month => {
            const monthData = filteredData.filter(d => d.bulan === month);
            if (monthData.length > 0) {
                monthlyData[month] = monthData.reduce((sum, d) => sum + d.realisasi, 0) / monthData.length;
            } else {
                monthlyData[month] = 0;
            }
        });
        
        // Data untuk grafik pie (per unit)
        const units = getUniqueUnits();
        const unitData = {};
        units.forEach(unit => {
            const uData = filteredData.filter(d => d.unit === unit);
            if (uData.length > 0) {
                unitData[unit] = uData.reduce((sum, d) => 
                    sum + parsePercentage(d['%pencapaian']), 0) / uData.length;
            } else {
                unitData[unit] = 0;
            }
        });
        
        // Hancurkan grafik yang ada jika ada
        if (barChart) barChart.destroy();
        if (lineChart) lineChart.destroy();
        if (pieChart) pieChart.destroy();
        
        // Buat grafik batang
        barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: Object.keys(monthlyData),
                datasets: [{
                    label: 'Rata-rata Realisasi',
                    data: Object.values(monthlyData),
                    backgroundColor: 'rgba(10, 76, 149, 0.7)',
                    borderColor: 'rgba(10, 76, 149, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Realisasi: ${context.raw.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Realisasi'
                        }
                    }
                }
            }
        });
        
        // Buat grafik garis
        lineChart = new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: Object.keys(monthlyData),
                datasets: [{
                    label: 'Tren Realisasi',
                    data: Object.values(monthlyData),
                    fill: false,
                    borderColor: 'rgb(255, 203, 5)',
                    backgroundColor: 'rgba(255, 203, 5, 0.5)',
                    tension: 0.1,
                    pointBackgroundColor: 'rgba(10, 76, 149, 1)',
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Realisasi: ${context.raw.toFixed(2)}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Realisasi'
                        }
                    }
                }
            }
        });
        
        // Buat grafik pie
        const backgroundColors = [
            'rgba(10, 76, 149, 0.7)',
            'rgba(255, 203, 5, 0.7)',
            'rgba(40, 167, 69, 0.7)',
            'rgba(220, 53, 69, 0.7)',
            'rgba(108, 117, 125, 0.7)',
            'rgba(23, 162, 184, 0.7)',
            'rgba(111, 66, 193, 0.7)'
        ];
        
        pieChart = new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: Object.keys(unitData),
                datasets: [{
                    label: '% Pencapaian',
                    data: Object.values(unitData),
                    backgroundColor: backgroundColors,
                    borderColor: 'white',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw.toFixed(2)}%`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Fungsi untuk filter tabel
    function filterTable(unitFilter = 'all', monthFilter = 'all') {
        let filteredData = data;
        if (unitFilter !== 'all') {
            filteredData = filteredData.filter(d => d.unit === unitFilter);
        }
        if (monthFilter !== 'all') {
            filteredData = filteredData.filter(d => d.bulan === monthFilter);
        }
        
        const tbody = document.getElementById('dataTable');
        tbody.innerHTML = '';
        
        filteredData.forEach(row => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${row.unit}</td>
                <td>${row.bulan}</td>
                <td>${parseFloat(row.target).toFixed(2)}</td>
                <td>${parseFloat(row.realisasi).toFixed(2)}</td>
                <td>${row['%pencapaian']}</td>
            `;
            tbody.appendChild(tr);
        });
    }
    
    // Terapkan filter saat tombol diklik
    document.getElementById('applyFilter').addEventListener('click', function() {
        const unitFilter = document.getElementById('unitFilter').value;
        const monthFilter = document.getElementById('monthFilter').value;
        
        filterTable(unitFilter, monthFilter);
        updateCharts(unitFilter, monthFilter);
    });
    
    // Inisialisasi
    calculateStats();
    updateCharts();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</body>
</html>